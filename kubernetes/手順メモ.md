# 手順メモ

## ローカルでアプリの動作を確認する。

当docker-comopse.yamlが存在しているディレクトリで以下のコマンドを  
実行すると、ローカルでアプリの動作を確認することができます。  
詳しくはdocker-compose.ymlファイルのコメントを見てください。  

## minikubeで動作を確認する。
### ローカルでdockerコンテナをdocker-composeではなく起動して動作確認する
Dockerfileからイメージを作成してDockerHubにイメージをpushする必要がある。  
まずはDockerhubにアカウントを作ってログインをしよう。  
二箇所のDockerfileのあるディレクトリに移動して以下のコマンドを実行します。  
kambeの文字列はそれぞれご自身のdockerhubのユーザー名にしてください。
```
docker build --tag=kambe/minikubereact:1.0 .
docker build --tag=kambe/minikubedjango:1.0 .
```

一旦今作ったイメージから起動して問題なくローカルで動作するかを確認してみましょう。  
docker-compose.ymlのあるディレクトリに移動します。
```
docker run --detach -p 3306:3306 --env-file ./mysql/.env --name mysql mysql:5.7 

docker run --detach -p 3000:3000 --env-file ./react/.env --name react kambe/minikubereact:1.0

docker ps 
docker inspect mysqlのコンテナID
出力されたNetworksのbridgeのIPAddressを./python/.envのDATABASE_HOSTに貼り付け

docker run --detach -p 8000:8000 --env-file ./python/.env --name python -i -t kambe/minikubedjango:1.1
docker ps 
docker exec -it 上記のコマンドで作成したpythonコンテナID bash
python manage.py migrate
```
作成した3つのコンテナはdocker stop コンテナID をしてからdocker rm コンテナID で削除しよう
そして./python/.envそしてファイルのDATABASE_HOSTにも、元のenvのDATABASE_HOST=dbとしておこう

動作確認ができたら、作成したイメージをdockerhubにpushしよう
```
docker push kambe/minikubedjango:1.1
docker push kambe/minikubereact:1.0
```
### minikubeで使用できるようなkubernetesのマニフェストyamlから作成